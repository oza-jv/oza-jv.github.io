<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>マウスクリックの練習</title>
</head>

<body>
<!-- ここに画面レイアウトをあらかじめ作っておく -->
<H1>マウスクリックの練習　10秒間追いかけろ！</h1>
<div><ul>
	<li>「スタート」を押すと，ピンクの的が移動します。</li>
	<li>的を追いかけて，マウスでクリックしよう。</li>
</ul></div>
<audio id="audio_ok"></audio>
<audio id="audio_ng"></audio>
<!-- video id="video1" width="320"></video -->
<!-- img id="img1" width="160"></img -->
<div id="div1"></div>
<canvas id="nako3_canvas" width="300" height="300" style="border-style: solid;"></canvas>

<!-- なでしこ3のエンジンを取り込み -->
<script type="text/javascript" src="https://nadesi.com/v3/cdn.php?v=3.1.19&f=release/wnako3.js&run"></script>
<!-- プラグインを取り込み -->
<script type="text/javascript" src="https://oza-jv.github.io/plugin_media.js"></script>

<!-- なでしこのプログラム -->
<script type="なでしこ">
// 初期設定 -- HTML内でなでしこを使うときは必ず実行する
結果領域＝「#div1」。
結果領域へDOM親要素設定。結果領域に「」をHTML設定。
描画領域＝「#nako3_canvas」。
描画領域へ描画開始。

// ここから，なでしこのプログラムを書いていきます

//描画キャンバスの初期設定
P＝描画中キャンバス。
MX＝描画中キャンバスの「width」をDOM属性取得。
MY＝描画中キャンバスの「height」をDOM属性取得。 

// グローバル変数の設定
TX=MX/2。TY=MY/2。		  // 的の初期位置（キャンバスの中央）
TR=15。TC=「#FFB6C1」。	// 的の半径，色（ピンク色）
TMV=25。				        // 的の移動量
得点＝０。
押数＝０。
処理可＝オフ。
押下フラグ＝オフ

// 画面やDOM要素の設定
音OK＝「audio_ok」。音OKに「./poka.wav」を音読込。
音NG＝「audio_ng」。音NGに「./basi.wav」を音読込。
スタートボタン＝「▶スタート」のボタン作成。
停止ボタン＝「■停止」のボタン作成。
改行作成。
改行作成。
結果ラベル＝「スタートボタンを押して始めよう！」のラベル作成。

// ボタンクリックのイベント
スタートボタンをクリックした時には
	結果ラベルに「がんばろう！」をテキスト設定。
	ゲームスタート。
ここまで。

停止ボタンをクリックした時には
	結果ラベルに「停止しました。」をテキスト設定。
	ゲームエンド。
ここまで。

// 的を描くサブルーチン設定
●的描く（XとYに）とは
	TCに塗色設定。
	1に線太設定。
	TCに線色設定。
	[X,Y]へTRの円描画。
ここまで。

●的消す（XとYの）とは
	白色に塗色設定。
	1に線太設定。
	灰色に線色設定。
	[X,Y]へTRの円描画。
ここまで。

●位置描く（XとYにCで）とは
	「#FFFFFF00」に塗色設定。
	3に線太設定。
	Cに線色設定。
	[X,Y]へTRの円描画。
ここまで。

// キャンバスを消す処理
●マップ消すとは
	[0,0,MX,MY]の描画クリア
	TX=MX/2。TY=MY/2。	// 的の初期位置
	TXとTYに的描く。
ここまで。

// ゲームスタートボタンを押した時の処理
●ゲームスタートとは
	マップ消す。

	得点＝０。
	押数＝０。
	処理可＝オン。

	１秒タイマー開始した時には（タイマーＩＤ）
		的移動。
	ここまで。

	１０秒後には
		結果ラベルに「ヒット{得点}回，はずれ{押数-得点}回，成功率{INT(得点/押数*100)}％でした。」をテキスト設定。
		ゲームエンド。
	ここまで。
ここまで。

// １０秒経った時と，ゲーム停止ボタンを押したときの処理
●ゲームエンドとは
	処理可＝オフ。
	全タイマー停止。
ここまで。

// 的を移動させる処理
●的移動とは
	TXとTYの的消す。
	
	(8の乱数)で条件分岐。   // ８方向へ移動させる
		0ならば、RDX= 0。RDY=-1。ここまで。
		1ならば、RDX= 1。RDY=-1。ここまで。
		2ならば、RDX= 1。RDY= 0。ここまで。
		3ならば、RDX= 1。RDY= 1。ここまで。
		4ならば、RDX= 0。RDY= 1。ここまで。
		5ならば、RDX=-1。RDY= 1。ここまで。
		6ならば、RDX=-1。RDY= 0。ここまで。
		違えば、 RDX=-1。RDY=-1。ここまで。
	ここまで。
	
	RD=((2の乱数)+1)*0.6。  // 移動量の0.6倍か1.2倍
	TX=TX+RDX*TMV*RD。
	もし、TX<TR*2ならば、   // はみ出した時の処理
		TX=TR*2。
	違えばもし、TX>(MX-TR*2)ならば、
		TX=(MX-TR*2)。
	ここまで。

	RD=((2の乱数)+1)*0.6。  // 移動量の0.6倍か1.2倍
	TY=TY+RDY*TMV*RD。
	もし、TY<TR*2ならば、   // はみ出した時の処理
		TY=TR*2。
	ここまで。
	もし、TY>(MY-TR*2)ならば、
		TY=(MY-TR*2)。
	ここまで。
	TXとTYに的描く。
ここまで。

// キャンバスをクリックした時の処理
Ｐをマウス押した時には
	もし、処理可＝オフならば、
		対象イベントのＤＯＭイベント処理停止。
		戻る。
	ここまで。

	// クリック位置(HX,HY)と，的の中心からの距離(Z)を取得
	HX=マウスX。HY=マウスY。
	ZX=(HX-TX)の絶対値。
	ZY=(HY-TY)の絶対値。
	Z=SQRT(ZX*ZX+ZY*ZY)。	// 距離
	押数＝押数＋１。

	// 当たり判定
	もし、Z<TRならば、
		// 的をクリックした時の処理
		HXとHYに赤色で位置描く。
		音OKを音再生。
		得点＝得点＋１。
		結果ラベルに「ヒット！{得点}回目」をテキスト設定。
		的移動。
	違えば、
		// 的以外をクリックした時の処理
		音NGを音再生。
		結果ラベルに「はずれ…」をテキスト設定。
	ここまで。
ここまで。

// 実行直後はマップを消しておく
マップ消す。
</script>
</body></html>
